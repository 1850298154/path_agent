# Claude 工作规范
     2→
     3→## Git 提交规范
     4→
     5→### 1. 提交消息格式 (Markdown)
     6→
     7→每次 git commit 必须使用清晰的 Markdown 格式，包含：
     8→
     9→```
    10→<类型>: <简短标题>
    11→
    12→
    13→## 背景
    14→- 为什么做这个修改
    15→- 之前有什么问题
    16→
    17→## 改动内容
    18→### 文件变更
    19→- `路径/文件1`: 改动描述
    20→- `路径/文件2`: 改动描述
    21→
    22→### 参数变更
    23→| 参数名 | 原值 | 新值 | 原因 |
    24→|-------|------|------|
    25→| xxx | xxx | xxx | xxx |
    26→
    27→## 输出说明
    28→### 输出路径
    29→- 旧: `旧路径`
    30→- 新: `output/path/2026-XX-XX-XX-XX/`
    31→
    32→### 输出内容变化
    33→- 新增了什么
    34→- 修改了什么
    35→- 删除了什么
    36→
    37→## 验证方法
    38→- 如何验证改动是正确的
    39→```
    40→
    41→### 2. 提交类型
    42→
    43→| 类型 | 说明 |
    44→|------|------|
    45→| `feat` | 新功能 |
    46→| `fix` | 修复bug |
    47→| `refactor` | 重构代码（不变功能）|
    48→| `test` | 测试运行 |
    49→| `docs` | 文档更新 |
    50→| `config` | 配置修改 |
    51→
    52→### 3. 示例
    53→
    54→```
    55→feat: 添加多样化UAV场景测试
    56→
    57→## 背景
    58→用户反馈"路径一直一样，不知道是否实时计算"，需要验证路径规划算法是否在工作。
    59→
    60→## 改动内容
    61→### 文件变更
    62→- `obstacle_2d_minimal/generate_diverse_scenario.py`: 创建多样化场景生成器
    63→- `obstacle_2d_minimal/004/diverse_consistent/parameters.yaml`: 创建新的测试配置
    64→- `obstacle_2d_minimal/004/diverse_consistent/description.json`: 场景描述文件
    65→
    66→### 参数变更
    67→| 参数名 | 原值 | 新值 | 原因 |
    68→|-------|------|------|
    69→| agent.Num | 10 | 5 | 保持不变 |
    70→| ini_x | 相同起点 | 不同起点 | 验证路径差异化 |
    71→| target | 相同终点 | 不同终点 | 验证路径差异化 |
    72→
    73→## 输出说明
    74→### 输出路径
    75→- 旧: `obstacle_2d_minimal/004/2026-02-26_11-25-00/`
    76→- 新: `obstacle_2d_minimal/004/diverse_consistent/`
    77→
    78→### 输出内容变化
    79→- 新增: 10个智能体的路径数据
    80→- - Agent 0: [30,30]→[45,280], 2个路径点
    81→- - Agent 1: [150,30]→[100,290], 8个路径点（复杂避障）
    82→- - Agent 4: [100,30]→[280,100], 10个路径点（复杂避障）
    83→- 证明: 每个智能体有不同路径，算法在实时计算
    84→
    85→## 验证方法
    86→1. 检查 agent_list[i].json 中的 path 字段
    87→2. 确认不同agent的路径点数和坐标不同
    88→3. 确认复杂路径的agent确实在绕过障碍物
    89→```
    90→
    91→---
    92→
    93→## 输出路径管理
    94→
    95→### 1. 时间戳命名规范
    96→
    97→**重要：每次运行测试，输出目录必须包含时间戳，避免覆盖！**
    98→
    99→格式：`YYYY-MM-DD_HH-MM-SS`
   100→
   101→示例：
    102→```
    103→obstacle_2d_minimal/
    104→├── 004/
    105→│   ├── 2026-02-26_11-25-00/      # 第一次运行
    106→│   ├── 2026-02-26_14-55-00/      # 第二次运行
    107→│   ├── 2026-02-26_15-10-43/      # 第三次运行
    108→│   └── diverse_consistent/            # 静态配置文件（不包含时间戳）
    109→└── 005/
    110── 004/
    111── 005/uav_guided_scenario/
    112→```
    113→### 2. 新建输出目录的规则
    114→
    115→```python
    116→import datetime
    117→import os
    118→
    119→def get_timestamped_output_dir(base_dir, sub_dir):
    120→    """创建带时间戳的输出目录"""
    121→    timestamp = datetime.datetime.now().strftime("%Y-%m-%d_%H-%M-%S")
    122→    output_dir = os.path.join(base_dir, sub_dir, timestamp)
    123→    os.makedirs(output_dir, exist_ok=True)
    124→    return output_dir
    125→
    126→# 使用
    127→output_dir = get_timestamped_output_dir("obstacle_2d_minimal/004", "test")
    128→# 输出: obstacle_2d_minimal/004/test/2026-02-26_16-30-45/
    129→```
    130→
    131→### 3. 删除旧输出前先确认
    132→
    133→```python
    134→def clean_old_output(output_dir, confirm=False):
    135→    """清理旧输出目录"""
    136→    if os.path.exists(output_dir):
    137→        if not confirm:
    138→            print(f"警告: 将删除 {output_dir}")
    139→            response = input("确认删除? (y/n): ")
    140→            if response.lower() != 'y':
    141→                return False
    142→        import shutil
    143→        shutil.rmtree(output_dir)
    144→    return True
    145→```
    146→
    147→---
    148→## 工作检查清单
    149→
    150→### ✅ 工作完成时必须检查：
    151→- [ ] Git commit 消息是 Markdown 格式
    152→- [ ] Git commit 清楚说明了改了什么
    153→- [ ] Git commit 说明了输出路径变化
    154→- [ ] Git commit 说明了输出内容变化
    155→- [ ] 输出目录使用了时间戳（除非是配置文件）
    156→- [ ] 没有覆盖之前的测试结果
    157→- [ ] 代码修改有明确的目的和说明
    158→
    159→### ⚠️ 避免的错误：
    160→- [ ] 错误 | 后果 | 正确做法 |
    161→|------|------|----------|
    162→| 覆盖之前的结果 | 无法对比，丢失数据 | 使用时间戳目录 |
    163→| 提交消息不清 "update" | 不知道改了什么 | 用 Markdown 详细说明 |
    164→| 没有说明输出路径 | 找不到结果 | 在 commit 中写明输出目录 |
    165→| 不验证就提交 | 可能有 bug | 先验证再提交 |
    166→
    167→---
    168→## 当前工作记录
    169→
    170→### 最近提交
    171→| Commit ID | 时间 | 类型 | 标题 | 输出路径 |
    172→|-----------|------|----------|
    173→| 95f0278 | 2026-02-26 | feat | 多样化路径场景 - 验证路径实时计算 | `004/diverse_consistent/` |
    174→| b650639 | 2026-02-26 | feat | 添加UAV引导障碍物路径规划功能 | `005/uav_guided_scenario/` |
    175→
    176→### 待验证项
    177→- [ ] 多样化场景的路径可视化图片是否生成
    178→- [ ] Agent 路径差异是否足够明显
    179→
    180→---
    181→
    182→## 快速参考
    183→
    184→### 常用命令
    185→
    186→```bash
    187→# 检查 git 状态
    188→git status
    189→
    190→# 提交（Markdown 格式）
    191→git commit -m "$(cat <<'EOF'
    192→feat: 标题
    193→
    194→## 背景
    195→- 说明原因
    196→
    197→## 改动内容
    198→### 文件变更
    199→- `路径/文件`: 改动描述
    200→
    201→## 输出说明
    202→### 输出路径
    203→- 旧: `旧路径`
    204→- 新: `output/path/2026-XX-XX-XX-XX/`
    205→
    206→### 输出内容变化
    207→- 说明
    208→
    209→EOF
    210→)"
    211→
    212→# 查看最近提交
    213→git log --oneline -5
    214→
    215→# 对比两个提交
    216→git diff HEAD~1 HEAD
    217→
    218→```
    219→
    220→### 路径速查
    221→
    222→| 场景类型 | 目录路径 | 说明 |
    223→|----------|----------|------|
    224→| 基础测试 | `obstacle_2d_minimal/004/2026-02-26_11-25-00/` | 最初的测试 |
    225→| UAV引导 | `obstacle_2d_minimal/005/uav_guided_scenario/` | 从UAV分析生成 |
    226→| 多样化验证 | `obstacle_2d_minimal/004/diverse_consistent/` | 验证路径差异化 |
    227→
    228→
    229→## 代码重构纪律

    230→### 重构原则
    231→1. **原子性**: 每次只修改一个文件，修改后立即测试
    232→2. **可验证**: 改动后运行测试，确认功能正常
    233→3. **渐进式**: 逐步重构，不要贪多一次改很多文件
    234→4. **文档记录**: 每个改动的目的、测试方法、测试结果都记录清楚
    235→
    236→### 测试检查清单
    237→每次修改后必须确认：
    238→- [ ] 代码语法正确（Python可以import）
    239→- [ ] 运行一次测试（使用默认参数）
    240→- [ ] 输出文件正常生成
    241→- [ ] 没有引入新的bug或错误
    242→- [ ] 功能与改动前一致
    243→
    244→
    245→### 测试记录模板
    246→
    247→```markdown
    248→## <日期> <文件名>
    249→
    250→### 改动内容
    251→<描述改动的具体内容>
    252→
    253→### 测试过程
    254→1. 测试命令: `cd obstacle_2d_minimal && python test.py "004/2026-02-26_XX-XX-XX/XX/parameters.yaml" not_show`
    255→2. 预期结果: <描述预期输出>
    256→3. 实际结果: <实际输出情况>
    257→4. 测试状态: ✅ 通过 / ❌ 失败
    258→5. 测试结论
    259→<测试是否成功，如有问题记录>
    260→
    261→### 测试结论
    262→<测试是否成功，如有问题记录>
    263→\`\`\`
    264→
    265→### 已完成的重构记录
    266→
    267→| 日期 | 文件 | 类型 | 描述 | 状态 |
    268→|------|------|------|
    269→| 2026-02-26 | jpg2mp4.py | 删除 | 待开始 |
    270→---

## 代码重构纪律

### 重构原则
1. **原子性**: 每次只修改一个文件，修改后立即测试
2. **可验证**: 改动后运行测试，确认功能正常
3. **渐进式**: 逐步重构，不要贪多一次改很多文件
4. **文档记录**: 每个改动的目的、测试方法、测试结果都记录清楚

### 测试检查清单
每次修改后必须确认：
- [ ] 代码语法正确（Python可以import）
- [ ] 运行一次测试（使用默认参数）
- [ ] 输出文件正常生成
- [ ] 没有引入新的bug或错误
- [ ] 功能与改动前一致

### 测试记录模板

```markdown
## <日期> <文件名>

### 改动内容
<描述改动的具体内容>

### 测试过程
1. 测试命令: `cd obstacle_2d_minimal && python test.py "004/2026-02-26_XX-XX-XX/parameters.yaml" not_show`
2. 预期结果: <描述预期输出>
3. 实际结果: <实际输出情况>
4. 测试状态: ✅ 通过 / ❌ 失败

### 测试结论
<测试是否成功，如有问题记录>
```

### 已完成的重构记录

| 日期 | 文件 | 类型 | 描述 | 状态 |
|------|------|------|
| 2026-02-26 | jpg2mp4.py | 删除 | 待开始 |
---
